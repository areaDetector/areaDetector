<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NDDriverStdArrays &mdash; areaDetector Support</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pvaDriver" href="../pvaDriver/pvaDriver.html" />
    <link rel="prev" title="Example st.cmd Startup File" href="../ADURL/st_cmd.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            areaDetector
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ADCore/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/arch.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/asynPortDriver.html">asynPortDriver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/NDArray.html">NDArray</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../detector_drivers.html">Detector Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../ADCore/guidelines.html">Guidelines and rules for drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADCore/ADDriver.html">ADDriver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAndor/andorDoc.html">ADAndor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAndor3/ADAndorDoc.html">ADAndor3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAravis/ADAravis.html">ADAravis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADCSimDetector/ADCSimDetectorDoc.html">ADCSimDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADDexela/ADDexela.html">ADDexela</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADEiger/eiger.html">ADEiger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADFastCCD/index.html">ADFastCCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADGenICam/ADGenICam.html">ADGenICam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADLambda/ADLambda.html">ADLambda</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADLightField/ADLightField.html">ADLightField</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADmarCCD/marCCDDoc.html">ADmarCCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADmar345/mar345Doc.html">ADmar345</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPerkinElmer/PerkinElmerDoc.html">ADPerkinElmer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPICam/PICamDoc.html">ADPICam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPilatus/pilatusDoc.html">ADPilatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPixirad/ADPixirad.html">ADPixirad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPointGrey/PointGreyDoc.html">ADPointGrey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADProsilica/ADProsilica.html">ADProsilica</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPvCam/pvcamDoc.html">ADPvCam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPylon/ADPylon.html">ADPylon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADQImaging/QImagingDoc.html">ADQImaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADRIXSCam/ADRIXSCam.html">ADRIXSCam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADSimDetector/simDetector.html">ADSimDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADSpinnaker/ADSpinnaker.html">ADSpinnaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADVimba/ADVimba.html">ADVimba</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADURL/ADURL.html">ADURL</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NDDriverStdArrays</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standard-areadetector-parameters">Standard areaDetector parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nddriverstdarrays-specific-driver-parameters">NDDriverStdArrays specific driver parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#screenshots">Screenshots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pvaDriver/pvaDriver.html">pvaDriver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specsAnalyser/index.html">specsAnalyser</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/plugins.html">areaDetector Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../additional_plugins.html">Additional plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/medm.html">MEDM screens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADViewers/ad_viewers.html">areaDetector Viewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acknowledgements.html">Acknowledgements and licenses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Top-level Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADCore_release.html">ADCore Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADSupport_release.html">ADSupport Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">Source Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detectors.html">Supported Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legacy_versions.html">Legacy Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">areaDetector</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user_guide.html">areaDetector Users Guide</a></li>
          <li class="breadcrumb-item"><a href="../detector_drivers.html">Detector Drivers</a></li>
      <li class="breadcrumb-item active">NDDriverStdArrays</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/NDDriverStdArrays/NDDriverStdArraysDoc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nddriverstdarrays">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">NDDriverStdArrays</a><a class="headerlink" href="#nddriverstdarrays" title="Link to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers (University of Chicago)</p>
</dd>
</dl>
<section id="table-of-contents">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Table of Contents</a><a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<nav class="contents" id="contents">
<p class="topic-title"><a class="reference internal" href="#contents">Contents</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#nddriverstdarrays" id="id1">NDDriverStdArrays</a></p>
<ul>
<li><p><a class="reference internal" href="#table-of-contents" id="id2">Table of Contents</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id3">Introduction</a></p></li>
<li><p><a class="reference internal" href="#standard-areadetector-parameters" id="id4">Standard areaDetector parameters</a></p></li>
<li><p><a class="reference internal" href="#nddriverstdarrays-specific-driver-parameters" id="id5">NDDriverStdArrays specific driver parameters</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id6">Configuration</a></p></li>
<li><p><a class="reference internal" href="#screenshots" id="id7">Screenshots</a></p>
<ul>
<li><p><a class="reference internal" href="#nddriverstdarrays-adl" id="id8">NDDriverStdArrays.adl</a></p></li>
<li><p><a class="reference internal" href="#unit-tests" id="id9">Unit tests</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</section>
<section id="introduction">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>This is an <a class="reference external" href="http://www.aps.anl.gov/epics/">EPICS</a>
<a class="reference external" href="areaDetector.html">areaDetector</a> driver that allows any EPICS
Channel Access client to create NDArrays in an areaDetector IOC. It is
the logical inverse of the
<a class="reference external" href="NDPluginStdArrays.html">NDPluginStdArrays</a>, which converts NDArrays
in an IOC into standard EPICS waveform records for use by Channel Access
clients. The NDPluginStdArrays plugin also writes to additional records
to describe the array structure. The NDDriverStdArrays driver receives
EPICS waveform records from Channel Access clients and converts them to
an NDArray in the IOC. The clients must also write to additional EPICS
records to define the structure of the NDArray. It is similar in concept
to the <a class="reference external" href="pvaDriverDoc.html">pvaDriver</a> which receives EPICS V4
NTNDArrays over the network and converts them to NDArrays in the IOC.
pvaDriver only works with EPICS V4 PVAccess clients, while
NDDriverStdArrays works with EPICS V3 Channel Access clients.</p>
<p>NDDriverStdArrays is based on an earlier driver called ADSoft written by
David Vine from LBNL. This driver generalizes ADSoft to support any
number of dimensions and any input waveform data type.</p>
<p>One use-case for this driver may be to receive data from the EPICS sscan
record. By putting such data into an areaDetector IOC it could then be
saved with the standard file saving plugins. It could also be processed
with ROI plugins, and then visualized with the standard areaDetector
viewers like ImageJ.</p>
<p>This driver inherits from <a class="reference external" href="areaDetectorDoc.html#ADDriver">ADDriver</a>.
It implements many of the parameters in
<a class="reference external" href="../areaDetectorDoxygenHTML/asyn_n_d_array_driver_8h.html">asynNDArrayDriver.h</a>
and in
<a class="reference external" href="../areaDetectorDoxygenHTML/_a_d_driver_8h.html">ADArrayDriver.h</a>. It
also implements a number of parameters that are specific to this driver.
The <a class="reference external" href="../areaDetectorDoxygenHTML/class_n_d_driver_std_arrays.html">NDDriverStdArrays class
documentation</a>
describes this class in detail.</p>
<p>The driver receives 1-D arrays, normally from an EPICS waveform record.
The NDimensions record controls the actual number of dimensions to use
when creating the NDArray. The Dimensions array record controls the
actual size of each of the NDimensions dimensions. The only limit on the
number of dimensions is the ND_ARRAY_MAX_DIMENSIONS value defined in
ADCore. This is normally 10. The ColorMode record can be used to define
the color mode (Mono, Bayer, RGB1, RGB2, or RGB3) of the NDArray. This
does not affect the operation of the driver, so the data in the waveform
record must be in the correct order for the specified color mode.</p>
<p>The data type of the NDArray is controlled by the DataType record. It
can be any of the datatypes Int8, UInt8, Int16, UInt16, Int32, UInt32,
Float32, or Float64. The datatype (FTVL) of the EPICS waveform record
can also be any of the types CHAR, UCHAR, SHORT, USHORT, LONG, ULONG,
FLOAT, or DOUBLE. The DTYP of the waveform record can be any of
asynInt8ArrayWfOut, asynInt16ArrayWfOut, asynInt32ArrayWfOut,
asynFloat32ArrayWfOut, or asynFloat64ArrayWfOut. The driver does any
required type conversion between the waveform record data and the
NDArray data.</p>
<p>The driver has 2 modes of operation, AppendMode=Disable and
AppendMode=Enable. When AppendMode is Disable then each write to the
waveform record will generate a complete NDArray. The first element of
the waveform record will be placed in the first element of the NDArray.
Generally the number of elements written should be equal to the total
number of elements in the NDArray. If it is greater then excess elements
will be discarded. If it is fewer then the NDArray will be zero-padded.</p>
<p>When AppendMode=Enable then the waveform record can contain just part of
the NDArray data, and data can be appended by multiple writes to the
waveform record to construct the complete NDArray. In append mode the
following records are used to control the operation of the driver. These
records have no effect if AppendMode=Disable.</p>
<ul>
<li><p>NewArray This record must be processed before sending data for a new
NDArray.</p></li>
<li><p>NextElement This record can be used to define the location in the
NDArray in which to write the data on the next waveform record write.
It is set to 0 when NewArray is processed, and is incremented by the
number of elements in the waveform record each time the waveform
record is written. Thus if the data are being written in the logical
order of the NDArray then this record does not need to be written.
This record is useful when the should not be written in the natural
order of the NDArray data.</p></li>
<li><p>Stride This record can be used to define the increment in the NDArray
index for each successive element in the waveform record. Data is
copied from the waveform record to the NDArray as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NDArray</span><span class="p">[</span><span class="n">NextElement</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">Stride</span><span class="p">]</span> <span class="o">=</span> <span class="n">waveform</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>The default value of Stride is 1.</p>
</li>
<li><p>ArrayComplete This record must be processed to tell the driver that
the NDArray is complete and that no more waveform records will be
written to this NDArray.</p></li>
</ul>
<p>The CallbackMode record controls when the driver does callbacks to
plugins. In append mode it may not be desireable to do callbacks each
time the waveform record is written, since that could happen thousands
of times per second if only small parts of the NDArray are written on
each call. The CallbackMode record has 3 choices:</p>
<ul class="simple">
<li><p>OnUpdate The callbacks will be done each time the NDArray is updated,
i.e. each time the waveform record is written.</p></li>
<li><p>OnComplete The callbacks will be done when the NDArray is complete.
This is equivalent to OnUpdate when AppendMode=Disable, but when
AppendMode=Enable then the callbacks will only happen after the
ArrayComplete record is processed.</p></li>
<li><p>OnCommand The callbacks are only called when the DoCallbacks record
is processed. This allows Channel Access clients to control when the
callbacks are done. The DoCallbacks record will also cause the
callbacks to be done when CallbackMode is OnUpdate or OnComplete.</p></li>
</ul>
</section>
<section id="standard-areadetector-parameters">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Standard areaDetector parameters</a><a class="headerlink" href="#standard-areadetector-parameters" title="Link to this heading"></a></h2>
<p>The following table describes how the NDDriverStdArrays driver
implements some of the standard driver parameters. The Acquire,
ImageMode, NumImages, ImageCounter, and ArrayCallbacks records are
handled in the standard way. The trigger, temperature, acquire time, and
gain related records are not implemented.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>Implementation of Parameters in asynNDArrayDriver.h and ADDriver.h, and EPICS Record
Definitions in ADBase.template and NDFile.template</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p>Parameter index variable</p></th>
<th class="head"><p>EPICS record name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>NDNDimensions</p></td>
<td><p>$(P)$(R)NDimensions</p></td>
<td><p>The number of dimensions in the NDArray to be created. Must be set before the waveform
record is written.</p></td>
</tr>
<tr class="row-even"><td><p>NDDimensions</p></td>
<td><p>$(P)$(R)Dimensions</p></td>
<td><p>An array containing the dimensions of the NDArray to be created. Must be set before
the waveform record is written.</p></td>
</tr>
<tr class="row-odd"><td><p>NDDataType</p></td>
<td><p>$(P)$(R)DataType</p></td>
<td><p>The data type of the NDArray to be created. Must be set before the waveform record
is written.</p></td>
</tr>
<tr class="row-even"><td><p>NDColorMode</p></td>
<td><p>$(P)$(R)ColorMode</p></td>
<td><p>The color mode of the NDArray to be created. Must be set before the waveform record
is written.</p></td>
</tr>
<tr class="row-odd"><td><p>N.A.</p></td>
<td><p>$(P)$(R)ArraySize[N], N=0, 9.</p></td>
<td><p>The $(P)$(R)Dimensions[0-9] values, extracted with a subarray record. These allow
for display of the NDArray dimensions.</p></td>
</tr>
<tr class="row-even"><td><p>N.A.</p></td>
<td><p>$(P)$(R)ArraySize[N]_RBV, N=0, 9.</p></td>
<td><p>The $(P)$(R)Dimensions_RB[0-9] values, extracted with a subarray record. These allow
for display of the dimensions of the currently defined data in the NDArray. These
will increment when AppendMode=Enable.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="nddriverstdarrays-specific-driver-parameters">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">NDDriverStdArrays specific driver parameters</a><a class="headerlink" href="#nddriverstdarrays-specific-driver-parameters" title="Link to this heading"></a></h2>
<p>The NDDriverStdArrays driver implements the following parameters in
addition to those in asynNDArrayDriver.h and ADDriver.h. The database
file is NDDriverStdArrays.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="7"><p><strong>Parameter Definitions in NDDriverStdArrays.h and EPICS Record Definitions</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p>Parameter index variable</p></th>
<th class="head"><p>asyn interface</p></th>
<th class="head"><p>Access</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>EPICS record name</p></th>
<th class="head"><p>EPICS record type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>NDSA_AppendMode</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Append mode. Choices are Disable (0) and Enable (1). See the description above.</p></td>
<td><p>NDSA_APPEND_MODE</p></td>
<td><p>$(P)$(R)AppendMode, $(P)$(R)AppendMode_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDSA_NumElements</p></td>
<td><p>asynInt32</p></td>
<td><p>r/o</p></td>
<td><p>The total number of elements in the NDArray.</p></td>
<td><p>NDSA_NUM_ELEMENTS</p></td>
<td><p>$(P)$(R)NumElements_RBV</p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-odd"><td><p>NDSA_NextElement</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>The next element in the NDArray to write to when AppendMode=Enable. See the description
above.</p></td>
<td><p>NDSA_NEXT_ELEMENT</p></td>
<td><p>$(P)$(R)NextElement, $(P)$(R)NextElement_RBV</p></td>
<td><p>longout, longin</p></td>
</tr>
<tr class="row-even"><td><p>NDSA_Stride</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>The stride to use for the NDArray index when copying data from the waveform record
to the NDArray. See the description above.</p></td>
<td><p>NDSA_STRIDE</p></td>
<td><p>$(P)$(R)Stride, $(P)$(R)Stride_RBV</p></td>
<td><p>longout, longin</p></td>
</tr>
<tr class="row-odd"><td><p>NDSA_FillValue</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The fill value to use for the NDArray. The NDArray is set to FillValue when AppendMode=Enable
and NewArray is processed, or when AppendMode=Disable and the number of elements
in the waveform record is fewer than the number of elements in the NDArray.</p></td>
<td><p>NDSA_FILL_VALUE</p></td>
<td><p>$(P)$(R)FillValue</p></td>
<td><p>ao</p></td>
</tr>
<tr class="row-even"><td><p>NDSA_NewArray</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Tell the driver to start a new NDArray when AppendMode=Enable. See the description
above.</p></td>
<td><p>NDSA_NEW_ARRAY</p></td>
<td><p>$(P)$(R)NewArray</p></td>
<td><p>bo</p></td>
</tr>
<tr class="row-odd"><td><p>NDSA_ArrayComplete</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Tell the driver that the current NDArray is complete when AppendMode=Enable. See
the description above.</p></td>
<td><p>NDSA_ARRAY_COMPLETE</p></td>
<td><p>$(P)$(R)ArrayComplete</p></td>
<td><p>bo</p></td>
</tr>
<tr class="row-even"><td><p>NDSA_CallbackMode</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Callback mode. See the description above. Choices are:</p>
<ul class="simple">
<li><p>0: OnUpdate</p></li>
<li><p>1: OnComplete</p></li>
<li><p>2: OnCommand</p></li>
</ul>
</td>
<td><p>NDSA_CALLBACK_MODE</p></td>
<td><p>$(P)$(R)CallbackMode, $(P)$(R)CallbackMode_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
</tr>
<tr class="row-odd"><td><p>NDSA_DoCallbacks</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Processing this record forces the driver to do callbacks to plugins.</p></td>
<td><p>NDSA_DO_CALLBACKS</p></td>
<td><p>$(P)$(R)DoCallbacks</p></td>
<td><p>bo</p></td>
</tr>
<tr class="row-even"><td><p>N.A.</p></td>
<td><p>N.A.</p></td>
<td><p>r/w</p></td>
<td><p>This record can periodically process the DoCallbacks record by setting is SCAN field.
It is disabled when $(P)$(R)Acquire is 0.</p></td>
<td><p>N.A.</p></td>
<td><p>$(P)$(R)DoCallbacksScan</p></td>
<td><p>bo</p></td>
</tr>
<tr class="row-odd"><td><p>NDSA_ArrayData</p></td>
<td><p>asynXXXArray</p></td>
<td><p>r/w</p></td>
<td><p>Waveform record containing the input data. The database requires 3 additional macros
for this record:</p>
<ul class="simple">
<li><p>TYPE The asyn interface XXX (XXX=Int8, Int16, Int32, Float32, or Float64)</p></li>
<li><p>FTVL The waveform record FTVL field (SHORT, USHORT, etc.)</p></li>
<li><p>NELEMENTS The total number of elements in the waveform record</p></li>
</ul>
</td>
<td><p>NDSA_ARRAY_DATA</p></td>
<td><p>$(P)$(R)ArrayIn</p></td>
<td><p>waveform</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>The NDDriverStdArrays driver is created with the NDDriverStdArraysConfig
command, either from C/C++ or from the EPICS IOC shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NDDriverStdArraysConfig</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">portName</span><span class="p">,</span>
              <span class="nb">int</span> <span class="n">maxBuffers</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">maxMemory</span><span class="p">,</span>
              <span class="nb">int</span> <span class="n">priority</span><span class="p">,</span> <span class="nb">int</span> <span class="n">stackSize</span><span class="p">)</span>
</pre></div>
</div>
<p>There an example IOC boot directory and startup script
(<a class="reference external" href="nd_std_arrays_st_cmd.html">iocBoot/iocNDDriverStdArrays/st.cmd)</a>
provided with areaDetector.</p>
</section>
<section id="screenshots">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Screenshots</a><a class="headerlink" href="#screenshots" title="Link to this heading"></a></h2>
<p>The following show the MEDM screens that are used to control the
NDDriverStdArrays driver.</p>
<section id="nddriverstdarrays-adl">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">NDDriverStdArrays.adl</a><a class="headerlink" href="#nddriverstdarrays-adl" title="Link to this heading"></a></h3>
<p>NDDriverStdArrays.adl is the screen used to control this driver.</p>
<a class="reference internal image-reference" href="../_images/NDDriverStdArrays.png"><img alt="../_images/NDDriverStdArrays.png" class="align-center" src="../_images/NDDriverStdArrays.png" style="width: 75%;" /></a>
</section>
<section id="unit-tests">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Unit tests</a><a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h3>
<p>The src/Python_tests and src/IDL_tests directories contain a number of
tests of the driver. The IDL tests are run by opening IDL and typing for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDL</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">run</span> <span class="n">MonoOverwrite</span>
</pre></div>
</div>
<p>The Python tests can all be run by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">test_NDDriverStdArrays</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Individual tests can be run by typing for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">test_NDDriverStdArrays</span><span class="o">.</span><span class="n">py</span> <span class="n">TestNDDriverStdArrays</span><span class="o">.</span><span class="n">testDataTypes</span>
</pre></div>
</div>
<p>When running the tests it is useful to be displaying the images, for
example in ImageJ. It is helpful to press the ImageJ “Auto” contrast
button as the tests are run, since they have different data ranges.</p>
<p>test_NDDriverStdArrays.py contains the following tests:</p>
<ul>
<li><p><strong>testDataTypes</strong> This test creates NDArrays of size 256x768 for each
allowed NDArray data type and corresponding Python data type. It
writes the complete array with a single channel access write to the
waveform record, i.e. with AppendMode=Disable. After writing each
array it reads it back to verify that the data read matches the data
written.</p></li>
<li><p><strong>testDataTypesAppend</strong> This test is the same as testDataTypes except
that the data are written with AppendMode=Enable. Each channel access
write to the waveform record writes “ystep” rows of the image.
“ystep” is set to 1 in the code, but can be edited to test writing
multiple rows at once. After writing each complete array it reads it
back to verify that the data read matches the data written.</p></li>
<li><p><strong>testContinuousMono</strong> This test writes 50 NDArrays of size 500x800
with ImageMode=Continuous, ColorMode=Mono, and AppendMode=Disable.
The images are a 2-D damped sine wave, where the frequency increases
with each successive image. After writing each complete array it
reads it back to verify that the data read matches the data written.</p></li>
<li><p><strong>testContinuousRGB1</strong> This test writes 20 NDArrays of size 3x600x800
with ImageMode=Continuous ColorMode=RGB1, and AppendMode=Disable. The
images are a 2-D damped sine wave, where the frequency increases with
each successive image and where the red, green, and blue images have
different frequencies. After writing each complete array it reads it
back to verify that the data read matches the data written.</p></li>
<li><p><strong>testScanPoint</strong> This test simulates collecting 2-D scan data for 4
detectors with size 100x200. The data are collected with
AppendMode=Enable. The data are appended to the NDArray one “pixel”
at a time, i.e. the waveform record is has 4 elements, one for each
detector. At the end of the scan the test configures the ROI1: plugin
to select each of the 4 detectors in turn and processes the
DoCallbacks record. This can display each of the detectors in
succession in the ImageJ plugin, for example.</p></li>
<li><p><strong>testScanPointReverse</strong> This is the same as testScanPoint except
that the data are collected in reverse order, i.e. from element
[99,199] backwards to element [0,0]. It thus tests the use of
NextElement.</p></li>
<li><p><strong>testScanLine</strong> This test simulates collecting 2-D scan data for 4
detectors with size 400x600. The data are collected with
AppendMode=Enable. The data are appended to the NDArray one “detector
line” at a time, i.e. the waveform record is has 400 elements,
containing the data for one detector for one row of the scan. The
NDArray can be one of the following shapes:</p>
<ul class="simple">
<li><p>[4,400,600] This is “detector interleaved”, and called
detIndex=0.  This is the default.</p></li>
<li><p>[400,4,600] This is “row interleaved”, and called detIndex=1.</p></li>
<li><p>[400,600,4] This is “plane interleaved”, and called detIndex=2.</p></li>
</ul>
<p>At the end of the scan the test configures the ROI1: plugin to select
each of the 4 detectors in turn and processes the DoCallbacks record.
This can display each of the detectors in succession in the ImageJ
plugin, for example.</p>
</li>
<li><p><strong>testScanLineIndex1</strong> This is the same as testScanLine, but with
detIndex=1.</p></li>
<li><p><strong>testScanLineIndex2</strong>This is the same as testScanLine, but with
detIndex=2.</p></li>
</ul>
<p>The following shows the NDPluginROI medm screen configured to select the
4’th detector in the NDArray. Note that the plugin has the CollapseDims
PV enabled. This results in output arrays of dimensions [100, 200],
rather than [1, 100, 200] which would be the case if CollapseDims was
disabled.</p>
<a class="reference internal image-reference" href="../_images/NDSA_testScanPoint_ROI4.png"><img alt="../_images/NDSA_testScanPoint_ROI4.png" class="align-center" src="../_images/NDSA_testScanPoint_ROI4.png" style="width: 75%;" /></a>
<p>The following shows the ImageJ screen displaying the output of the 4’th
detector via ROI4. The NDPluginStdArrays was set to have ROI4 as its
array input.</p>
<a class="reference internal image-reference" href="../_images/NDSA_testScanPoint_ROI4_ImageJ.png"><img alt="../_images/NDSA_testScanPoint_ROI4_ImageJ.png" class="align-center" src="../_images/NDSA_testScanPoint_ROI4_ImageJ.png" style="width: 25%;" /></a>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ADURL/st_cmd.html" class="btn btn-neutral float-left" title="Example st.cmd Startup File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../pvaDriver/pvaDriver.html" class="btn btn-neutral float-right" title="pvaDriver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mark Rivers.
      <span class="lastupdated">Last updated on 2023-September-21.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>