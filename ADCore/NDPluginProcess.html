<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NDPluginProcess &mdash; areaDetector Support</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme_overrides.css?v=254ed751" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NDPluginPva" href="NDPluginPva.html" />
    <link rel="prev" title="NDPluginOverlay" href="NDPluginOverlay.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            areaDetector
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="arch.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="asynPortDriver.html">asynPortDriver</a></li>
<li class="toctree-l2"><a class="reference internal" href="NDArray.html">NDArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../detector_drivers.html">Detector Drivers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="plugins.html">areaDetector Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plugin_overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginDriver.html">NDPluginDriver</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_guidelines.html">Guidelines and rules for plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_medm.html">Base class medm screens</a></li>
<li class="toctree-l3"><a class="reference internal" href="common_plugins.html">commonPlugins.cmd</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_performance.html">Performance example</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginAttrPlot.html">NDPluginAttrPlot</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginAttribute.html">NDPluginAttribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginBadPixel.html">NDPluginBadPixel</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginCircularBuff.html">NDPluginCircularBuff</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginCodec.html">NDPluginCodec</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginColorConvert.html">NDPluginColorConvert</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginFFT.html">NDPluginFFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginFile.html">NDPluginFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginGather.html">NDPluginGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginOverlay.html">NDPluginOverlay</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NDPluginProcess</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#screen-shots">Screen shots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginPva.html">NDPluginPva</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginROI.html">NDPluginROI</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginROIStat.html">NDPluginROIStat</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginScatter.html">NDPluginScatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginStats.html">NDPluginStats</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginStdArrays.html">NDPluginStdArrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginTimeSeries.html">NDPluginTimeSeries</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginTransform.html">NDPluginTransform</a></li>
<li class="toctree-l3"><a class="reference internal" href="NDPluginPos.html">NDPosPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="ffmpegServer.html">ffmpegServer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../additional_plugins.html">Additional plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="medm.html">MEDM screens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADViewers/ad_viewers.html">areaDetector Viewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acknowledgements.html">Acknowledgements and licenses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Top-level Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADCore_release.html">ADCore Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADSupport_release.html">ADSupport Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">Source Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detectors.html">Supported Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legacy_versions.html">Legacy Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">areaDetector</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user_guide.html">areaDetector Users Guide</a></li>
          <li class="breadcrumb-item"><a href="plugins.html">areaDetector Plugins</a></li>
      <li class="breadcrumb-item active">NDPluginProcess</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ADCore/NDPluginProcess.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ndpluginprocess">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">NDPluginProcess</a><a class="headerlink" href="#ndpluginprocess" title="Link to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers, University of Chicago</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ndpluginprocess" id="id1">NDPluginProcess</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#recursive-filter-implementation" id="id3">Recursive filter implementation</a></p></li>
<li><p><a class="reference internal" href="#predefined-filters" id="id4">Predefined filters</a></p>
<ul>
<li><p><a class="reference internal" href="#recursive-average" id="id5">Recursive Average</a></p></li>
<li><p><a class="reference internal" href="#average" id="id6">Average</a></p></li>
<li><p><a class="reference internal" href="#sum" id="id7">Sum</a></p></li>
<li><p><a class="reference internal" href="#difference" id="id8">Difference</a></p></li>
<li><p><a class="reference internal" href="#recursive-average-difference" id="id9">Recursive Average Difference</a></p></li>
<li><p><a class="reference internal" href="#copy-to-filter" id="id10">Copy to Filter</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration" id="id11">Configuration</a></p></li>
<li><p><a class="reference internal" href="#screen-shots" id="id12">Screen shots</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>NDPluginProcess performs arithmetic processing on NDArray data. It
performs the following operations in the order listed. Each of these
operations can be individually enabled and disabled.</p>
<ul class="simple">
<li><p>Subtracts a background array which has been previously acquired.</p></li>
<li><p>Divides by a flat field array which has been previously acquired, and
then multiplies by a flat field scale factor.</p></li>
<li><p>Adds an offset and then multiplies by a scale factor.</p></li>
<li><p>Clips to a maximum specified value.</p></li>
<li><p>Clips to a minimum specified value.</p></li>
<li><p>Applies a recursive digital filter.</p></li>
<li><p>Converts to the specified output data type.</p></li>
<li><p>Exports the processed data as a new NDArray object.</p></li>
</ul>
<p>If any of the above operations is enabled, then the array is first
converted to NDFloat64 data type, i.e. double-precision float. The
operations are all performed in double-precision, and then the array is
converted to the specified output data type.</p>
<p>NDPluginProcess is both a <strong>recipient</strong> of callbacks and a <strong>source</strong> of
NDArray callbacks. This means that other plugins, such the
NDPluginStdArrays, NDPluginStats, and NDPluginFile plugins can be
connected to an NDPluginProcess plugin, in which case they will use the
processed data.</p>
<p>NDPluginProcess is fully N-dimensional. It can be used for 2-D images,
3-D (color) images, or any type of N-dimensional data.</p>
<p>NDPluginProcess inherits from NDPluginDriver. The <a class="reference external" href="../areaDetectorDoxygenHTML/class_n_d_plugin_process.html">NDPluginProcess class
documentation</a>
describes this class in detail.</p>
<p>NDPluginProcess.h defines the following parameters. It also implements
all of the standard plugin parameters from
<a class="reference external" href="pluginDoc.html#NDPluginDriver">NDPluginDriver</a>. The EPICS database
NDProcess.template provide access to these parameters, listed in the
following table. Note that to reduce the width of this table the
parameter index variable names have been split into 2 lines, but these
are just a single name, for example <code class="docutils literal notranslate"><span class="pre">NDPluginProcessSaveBackground</span></code>.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<colgroup>
<col style="width: 5.0%" />
<col style="width: 5.0%" />
<col style="width: 5.0%" />
<col style="width: 70.0%" />
<col style="width: 5.0%" />
<col style="width: 5.0%" />
<col style="width: 5.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
<th class="head" colspan="5"><p><strong>Parameter Definitions in NDPluginProcess.h and EPICS Record Definitions in NDProcess.template</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p>Parameter index variable</p></th>
<th class="head"><p>asyn interface</p></th>
<th class="head"><p>Access</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>EPICS record name</p></th>
<th class="head"><p>EPICS record type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td></td>
<td></td>
<td colspan="5"><p><strong>Background subtraction</strong></p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, SaveBackground</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Command to use the most recently acquired array as a background. Note that this
recently acquired array should have been acquired with EnableBackground=0, or else
that array will already have had the background subtracted, which is probably not
what was intended!</p></td>
<td><p>SAVE_BACKGROUND</p></td>
<td><p>$(P)$(R)SaveBackground, $(P)$(R)SaveBackground_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, ValidBackground</p></td>
<td><p>asynInt32</p></td>
<td><p>r/o</p></td>
<td><p>Flag indicating whether there is a valid background array that has been acquired
for this array using SaveBackground. This flag will be Invalid (0) if no background
has been acquired, or if the size of the array has changed since the background
was last acquired.</p></td>
<td><p>VALID_BACKGROUND</p></td>
<td><p>$(P)$(R)ValidBackground_RBV</p></td>
<td><p>bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, EnableBackground</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag indicating whether the background array acquired with SaveBackground should
be subtracted when processing the array. If ValidBackground=0 then no background
subtraction is done even if EnableBackground=Enable.</p></td>
<td><p>ENABLE_BACKGROUND</p></td>
<td><p>$(P)$(R)EnableBackground, $(P)$(R)EnableBackground_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>N.A.</p></td>
<td><p>N.A.</p></td>
<td><p>r/w</p></td>
<td><p>This is a convenience sseq record to simplify reading the background array from
a TIFF file. Prior to processing this record the $(P)$(R)TIFF: plugin records must
be correctly configured to read the desired background TIFF file. Processing this
record does the following steps. <br>
1. Saves the current value of $(P)$(R)NDArrayPort in a temporary location. <br>
2. Sets the NDArrayPort to $(P)$(R)TIFF:PortName_RBV, i.e. the TIFF plugin associated
with this plugin. <br>
3. Enables ArrayCallbacks for the TIFF plugin in case they were not enabled. <br>
4. Writes 1 to $(R)$(P)TIFF:ReadFile. This causes the TIFF plugin to read the selected
file, do callbacks to the Process plugin. <br>
5. Writes 1 to $(P$(R)SaveBackground, saving the array read from the TIFF plugin
as the new background. <br>
6. Restores $(P)$(R)NDArrayPort from the temporary location <br></p></td>
<td><p>N.A.</p></td>
<td><p>$(P)$(R)ReadBackgroundTIFFSeq</p></td>
<td><p>sseq</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td colspan="5"><p><strong>Flat field normalization</strong></p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, SaveFlatField</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Command to use the most recently acquired array as a flat field. Note that this
recently acquired array should have been acquired with EnableFlatField=0, or else
that array will already have been flat field normalized, which is probably not what
was intended!</p></td>
<td><p>SAVE_FLAT_FIELD</p></td>
<td><p>$(P)$(R)SaveFlatField, $(P)$(R)SaveFlatField_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, ValidFlatField</p></td>
<td><p>asynInt32</p></td>
<td><p>r/o</p></td>
<td><p>Flag indicating whether there is a valid flat field array that has been acquired
for this array using SaveFlatField. This flag will be Invalid (0) if no flat field
has been acquired, or if the size of the array has changed since the flat field
was last acquired.</p></td>
<td><p>VALID_FLAT_FIELD</p></td>
<td><p>$(P)$(R)ValidFlatField_RBV</p></td>
<td><p>bi</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, EnableFlatField</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag indicating whether the array should be divided by the flat field array (acquired
with SaveFlatField) when processing the array. If ValidFlatField=0 then no flat
field normalization is done even if EnableBackground=Enable. The processing step
consists of:
, Array = Array / FlatField * ScaleFlatField</p></td>
<td><p>ENABLE_FLAT_FIELD</p></td>
<td><p>$(P)$(R)EnableFlatField, $(P)$(R)EnableFlatField_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, ScaleFlatField</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The scale factor to multiply by after dividing the array by the flat field array.
This scale factor is normally chosen so that the data after scaling fills the dynamic
range of the output data type.</p></td>
<td><p>SCALE_FLAT_FIELD</p></td>
<td><p>$(P)$(R)ScaleFlatField, $(P)$(R)ScaleFlatField_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>N.A.</p></td>
<td><p>N.A.</p></td>
<td><p>r/w</p></td>
<td><p>This is a convenience sseq record to simplify reading the flatfield array from a
TIFF file. Prior to processing this record the $(P)$(R)TIFF: plugin records must
be correctly configured to read the desired flatfield TIFF file. Processing this
record does the following steps. <br>
1. Saves the current value of $(P)$(R)NDArrayPort in a temporary location. <br>
2. Sets the NDArrayPort to $(P)$(R)TIFF:PortName_RBV, i.e. the TIFF plugin associated
with this plugin. <br>
3. Enables ArrayCallbacks for the TIFF plugin in case they were not enabled. <br>
4. Writes 1 to $(R)$(P)TIFF:ReadFile. This causes the TIFF plugin to read the selected
file, do callbacks to the Process plugin. <br>
5. Writes 1 to $(P$(R)SaveFlatFeild, saving the array read from the TIFF plugin as
the new flatfield. <br>
6. Restores $(P)$(R)NDArrayPort from the temporary location <br></p></td>
<td><p>N.A.</p></td>
<td><p>$(P)$(R)ReadFlatFieldTIFFSeq</p></td>
<td><p>sseq</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td colspan="5"><p><strong>Scaling and offset</strong></p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, EnableOffsetScale</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag indicating whether the array should be summed with an Offset and then multiplied
by Scale when processing the array. The processing step consists of:
Array = (Array + Offset) * Scale</p></td>
<td><p>ENABLE_OFFSET_SCALE</p></td>
<td><p>$(P)$(R)EnableOffsetScale, $(P)$(R)EnableOffsetScale_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, AutoOffsetScale</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Processing this record will enable Offset and Scale calculations, and set the Offset=-min(Array)
and Scale=MaxScale/(max(Array)-min(Array)), where MaxScale is the maximum value
of the output data type. The output array will thus be scaled to go from zero
to the maximum value of the output data type. Note that the calculation of the offset and scale
factors is only done once when this record is processed, and these values are used
for subsequent array callbacks, i.e. it does not autoscale on each array callback.
Thanks to Tom Cobb for this addition.</p></td>
<td><p>AUTO_OFFSET_SCALE</p></td>
<td><p>$(P)$(R)AutoOffsetScale</p></td>
<td><p>busy</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, Scale</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The scale factor to multiply by.</p></td>
<td><p>SCALE</p></td>
<td><p>$(P)$(R)Scale, $(P)$(R)Scale_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, Offset</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The offset to add.</p></td>
<td><p>OFFSET</p></td>
<td><p>$(P)$(R)Offset, $(P)$(R)Offset_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td colspan="5"><p><strong>Low and high clipping</strong></p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, EnableLowClip</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag to control whether to clip values to the LowClip value for this array (0=Disable,
1=Enable).</p></td>
<td><p>ENABLE_LOW_CLIP</p></td>
<td><p>$(P)$(R)EnableLowClip, $(P)$(R)EnableLowClip_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, LowClipThresh</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The low clipping threshold. If EnableLowClip=1, then all values in
the array less than LowClipThresh will be replaced by LowClipValue.</p></td>
<td><p>LOW_CLIP_THRESH</p></td>
<td><p>$(P)$(R)LowClipThresh, $(P)$(R)LowClipThresh_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, LowClipValue</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The low clipping replacement value. If EnableLowClip=1, then all values in
the array less than LowClipThresh will be replaced by LowClipValue.</p></td>
<td><p>LOW_CLIP_VALUE</p></td>
<td><p>$(P)$(R)LowClipValue, $(P)$(R)LowClipValue_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, EnableHighClip</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag to control whether to clip values to the HighClip value for this array (0=Disable,
1=Enable).</p></td>
<td><p>ENABLE_HIGH_CLIP</p></td>
<td><p>$(P)$(R)EnableHighClip, $(P)$(R)EnableHighClip_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, HighClipThresh</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The high clipping threshold. If EnableHighClip=1, then all values in
the array greater than HighClipThresh will be replaced by HighClipValue.</p></td>
<td><p>HIGH_CLIP_THRESH</p></td>
<td><p>$(P)$(R)HighClipThresh, $(P)$(R)HighClipThresh_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, HighClipValue</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>The high clipping replacement value. If EnableHighClip=1, then all values in
the array greater than HighClipThresh will be replaced by HighClipValue.</p></td>
<td><p>HIGH_CLIP_VALUE</p></td>
<td><p>$(P)$(R)HighClipValue, $(P)$(R)HighClipValue_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, DataType</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Data type of the output array (NDDataType_t). This can be different from the data
type of the NDArray callback data.</p></td>
<td><p>PROCESS_DATA_TYPE</p></td>
<td><p>$(P)$(R)DataTypeOut, $(P)$(R)DataTypeOut_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td colspan="5"><p><strong>Recursive filter</strong></p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, EnableFilter</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Flag indicating whether the array should be processed with a recursive filter. The
details of the filter operation are explained below., - ENABLE_FILTER</p></td>
<td><p>$(P)$(R)EnableFilter, $(P)$(R)EnableFilter_RBV</p></td>
<td colspan="2"><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, ResetFilter</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Command to reset the filter back to its initial state.</p></td>
<td><p>RESET_FILTER</p></td>
<td><p>$(P)$(R)ResetFilter, $(P)$(R)ResetFilter_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, AutoResetFilter</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>If enabled then when NumFiltered=NumFilter the filter automatically resets. This
can be very useful when using the Average or Sum filter modes. As soon as N sums
or averages have been performed the filter resets, so the next sum or average is
computed.</p></td>
<td><p>AUTO_RESET_FILTER</p></td>
<td><p>$(P)$(R)AutoResetFilter, $(P)$(R)AutoResetFilter_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, FilterCallbacks</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>Choices are “Every array” and “Array N only”. If “Every array” is selected then
the plugin does callbacks for every incoming array it receives. If “Array N only”
is selected then the plugin only does callbacks when NumFiltered=NumFilter. This
can be very useful when using the Sum or Average filter modes. Callbacks are then
done only when N sums or averages have been performed. If used with AutoResetFilter
then as input arrays arrive the plugin will continually output one summed or averaged
array after every N incoming arrays.</p></td>
<td><p>FILTER_CALLBACKS</p></td>
<td><p>$(P)$(R)FilterCallbacks, $(P)$(R)FilterCallbacks_RBV</p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, NumFilter</p></td>
<td><p>asynInt32</p></td>
<td><p>r/w</p></td>
<td><p>The characteristic number of arrays to use when filtering. The value of NumFiltered
will increase as each array is processed, until it reaches the value of NumFilter,
when it will no longer increase. The value of NumFiltered is used in the filter
equations, as explained below.</p></td>
<td><p>NUM_FILTER</p></td>
<td><p>$(P)$(R)NumFilter, $(P)$(R)NumFilter_RBV</p></td>
<td><p>longout, longin</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, NumFiltered</p></td>
<td><p>asynInt32</p></td>
<td><p>r/o</p></td>
<td><p>The number of arrays that have been processed by the filter since the filter was
last reset. The value of NumFiltered is incremented as each array is processed,
until it reaches the value of NumFilter, when it will cease incrementing. The value
of NumFiltered is used in the filter equations, as explained below.</p></td>
<td><p>NUM_FILTERED</p></td>
<td><p>$(P)$(R)NumFiltered_RBV</p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-even"><td><p>N.A.</p></td>
<td><p>N.A.</p></td>
<td><p>r/w</p></td>
<td><p>The filter type, chosen from a predefined list, as described below.</p></td>
<td><p>N.A.</p></td>
<td><p>$(P)$(R)FilterType</p></td>
<td><p>mbbo</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, OOffset</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output offset coefficient.</p></td>
<td><p>FILTER_OOFFSET</p></td>
<td><p>$(P)$(R)OOffset, $(P)$(R)OOffset_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, OScale</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output scale coefficient.</p></td>
<td><p>FILTER_OSCALE</p></td>
<td><p>$(P)$(R)OScale, $(P)$(R)OScale_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, OC1</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output coefficient #1.</p></td>
<td><p>FILTER_OC1</p></td>
<td><p>$(P)$(R)OC1, $(P)$(R)OC1_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, OC2</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output coefficient #2.</p></td>
<td><p>FILTER_OC2</p></td>
<td><p>$(P)$(R)OC2, $(P)$(R)OC2_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, OC3</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output coefficient #3.</p></td>
<td><p>FILTER_OC3</p></td>
<td><p>$(P)$(R)OC3, $(P)$(R)OC3_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, OC4</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Output coefficient #4.</p></td>
<td><p>FILTER_OC4</p></td>
<td><p>$(P)$(R)OC4, $(P)$(R)OC4_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, FOffset</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter offset coefficient.</p></td>
<td><p>FILTER_FOFFSET</p></td>
<td><p>$(P)$(R)FOffset, $(P)$(R)FOffset_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, FScale</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter scale coefficient.</p></td>
<td><p>FILTER_FSCALE</p></td>
<td><p>$(P)$(R)FScale, $(P)$(R)FScale_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, FC1</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #1.</p></td>
<td><p>FILTER_FC1</p></td>
<td><p>$(P)$(R)FC1, $(P)$(R)FC1_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, FC2</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #2.</p></td>
<td><p>FILTER_FC2</p></td>
<td><p>$(P)$(R)FC2, $(P)$(R)FC2_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, FC3</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #3.</p></td>
<td><p>FILTER_FC3</p></td>
<td><p>$(P)$(R)FC3, $(P)$(R)FC3_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, FC4</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #4.</p></td>
<td><p>FILTER_FC4</p></td>
<td><p>$(P)$(R)FC4, $(P)$(R)FC4_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, ROffset</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Reset offset coefficient.</p></td>
<td><p>FILTER_ROFFSET</p></td>
<td><p>$(P)$(R)ROffset, $(P)$(R)ROffset_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-even"><td><p>NDPluginProcess, RC1</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #1.</p></td>
<td><p>FILTER_RC1</p></td>
<td><p>$(P)$(R)RC1, $(P)$(R)RC1_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>NDPluginProcess, RC2</p></td>
<td><p>asynFloat64</p></td>
<td><p>r/w</p></td>
<td><p>Filter coefficient #2.</p></td>
<td><p>FILTER_RC2</p></td>
<td><p>$(P)$(R)RC2, $(P)$(R)RC2_RBV</p></td>
<td><p>ao, ai</p></td>
</tr>
</tbody>
</table>
<section id="recursive-filter-implementation">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Recursive filter implementation</a><a class="headerlink" href="#recursive-filter-implementation" title="Link to this heading"></a></h3>
<p>The recursive filter performs filtering in the time (not spatial)
domain. It is implemented in a fairly general manner, so that a variety
of filters can be implemented. These include integrating filters and
differentiating filter types. The recursive filter stores one “filter”
array internally. Using this internal filter array, and a new input
array, it computes an output array, and a new version of the filter
array. The equations governing the output array and new filter array
are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">OOffset</span> <span class="o">+</span> <span class="n">OScale</span><span class="o">*</span><span class="p">((</span><span class="n">OC1</span> <span class="o">+</span> <span class="n">OC2</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="p">(</span><span class="n">OC3</span> <span class="o">+</span> <span class="n">OC4</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">FOffset</span> <span class="o">+</span> <span class="n">FScale</span><span class="o">*</span><span class="p">((</span><span class="n">FC1</span> <span class="o">+</span> <span class="n">FC2</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                         <span class="p">(</span><span class="n">FC3</span> <span class="o">+</span> <span class="n">FC4</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
<span class="n">On</span> <span class="nb">filter</span> <span class="n">reset</span>
<span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROffset</span> <span class="o">+</span> <span class="n">RC1</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">RC2</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">where</span>
  <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">New</span> <span class="nb">input</span> <span class="n">array</span> <span class="kn">from</span> <span class="nn">callback</span>
  <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">First</span> <span class="nb">input</span> <span class="n">array</span> <span class="n">after</span> <span class="n">a</span> <span class="nb">filter</span> <span class="n">reset</span>
<span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stored</span> <span class="nb">filter</span> <span class="n">array</span>
  <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">New</span> <span class="nb">filter</span> <span class="n">array</span>
  <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Current</span> <span class="nb">filter</span> <span class="n">array</span> <span class="n">when</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="n">reset</span><span class="o">.</span>
         <span class="n">May</span> <span class="n">be</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">there</span> <span class="n">was</span> <span class="n">no</span> <span class="n">valid</span> <span class="nb">filter</span> <span class="n">array</span><span class="o">.</span>
     <span class="n">N</span> <span class="o">=</span> <span class="n">Current</span> <span class="n">value</span> <span class="n">of</span> <span class="n">NumFiltered</span>
  <span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Output</span> <span class="n">array</span> <span class="n">passed</span> <span class="n">to</span> <span class="n">clients</span>
</pre></div>
</div>
</section>
<section id="predefined-filters">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Predefined filters</a><a class="headerlink" href="#predefined-filters" title="Link to this heading"></a></h3>
<p>The NDProcess.template database implements the following predefined
filters using the <code class="docutils literal notranslate"><span class="pre">$(P)$(R)FilterType</span></code> record. The implementation of these
predefined filter types is done entirely in the database, not in the
plugin code. The database simply downloads values of OC1-OC4, FC1-FC4,
and RC1-RC2 that result in predefined filter behaviours. The operation
of the recursive filter is by no means limited to these fixed filter
types, they are simply provided as a convenience, and can be easily
modified or extended. Note that the database does not download values of
OOffset, OScale, FOffset, FScale, or ROffset, so these remain unchanged
when a new filter is selected. The equations below do not include these
offset and scale values, but they are useful in many circumstances.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NDProcess_settings.req</span></code> file for save/restore saves the values of all
of the filter coefficients, and downloads them when EPICS initialized at
iocInit. It also saves the FilterType, but does not process this record
at iocInit, so that any customized filter coefficients will be
preserved, and will not be replaced by the defaults for that filter
type.</p>
<section id="recursive-average">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Recursive Average</a><a class="headerlink" href="#recursive-average" title="Link to this heading"></a></h4>
<p>The recursive average filter does input array averaging. It is defined
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>N is the characteristic number of arrays in the average. For example, if
N=100, then each new array is weighted by 0.01 and the previous filter
value is weighted by 0.99. This is an infinite impulse response (IIR)
filter, because the effect of one array never complelely dissappears,
but rather decays exponentially. When this filter is reset the filter
array is initialized with the first input array. This filter can be used
to decrease the noise and increase the dynamic range of a repetitive
input signal with a small signal. In that case it can be useful to use
set EnableOffsetScale=Enable and set Scale to a large enough number to
more fully use the dynamic range of the output data type. The averaged
signal will then better use the dynamic range of the output data type.</p>
</section>
<section id="average">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Average</a><a class="headerlink" href="#average" title="Link to this heading"></a></h4>
<p>The average filter does input array averaging. It is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>N is the number of arrays in the average. For example, if N=100, then
each new array is weighted by 0.01. When this filter is reset the filter
array is initialized to 0. This filter typically cannot be run forever,
because the output grows monotonically and will lead to overflow.
However, if AutoResetFilter is enabled then the filter will be reset
when NumFiltered=NumFilter. If ArrayCallbacks is “Array N only” then
callbacks will be done only with the final averaged value.</p>
</section>
<section id="sum">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Sum</a><a class="headerlink" href="#sum" title="Link to this heading"></a></h4>
<p>The sum filter does input array summing. It is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>This filter simply computes the sum of input arrays. When this filter is
reset the filter array is initialized to 0. It is often necessary to set
the output data type to one with a larger maximum value than the input
array to prevent overflow. If AutoResetFilter is enabled then the filter
will be reset when NumFiltered=NumFilter. If ArrayCallbacks is “Array N
only” then callbacks will be done only with the final summed value.</p>
</section>
<section id="difference">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Difference</a><a class="headerlink" href="#difference" title="Link to this heading"></a></h4>
<p>The difference filter computes the difference between frame N and frame
N-1. It is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that the difference will often be a small signed number. If the
output datatype is unsigned, or if a display client expects unsigned
numbers, then it can be useful to set OOffset to a non-zero value to add
an offset to the result. For example, if the output data type is UInt8
(unsigned 8-bit), then setting OOffset to 128 will produce an unsigned
image centered at 128. Similarly OScale can be used to increase the
range of the difference by multiplying by a factor greater than 1,
although this will not increase the dynamic range of the result, only
the absolute range.</p>
</section>
<section id="recursive-average-difference">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Recursive Average Difference</a><a class="headerlink" href="#recursive-average-difference" title="Link to this heading"></a></h4>
<p>This filter computes the difference between frame N and the recursive
average of previous frames. It is a combination of the Difference and
Recursive Average filters described above. The new filter is a recursive
average, but the output is the difference between the current frame and
that recursive average. It is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>N is again the characteristic number of arrays in the average.</p>
</section>
<section id="copy-to-filter">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Copy to Filter</a><a class="headerlink" href="#copy-to-filter" title="Link to this heading"></a></h4>
<p>This filter simply copies the input array to the filter array and the
output array. It is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</pre></div>
</div>
<p>This filter can be used to load the filter (F) with a certain array,
which is then subsequently used for some other filter type.</p>
</section>
</section>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>The NDPluginProcess plugin is created with the NDProcessConfigure
command, either from C/C++ or from the EPICS IOC shell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NDProcessConfigure</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">portName</span><span class="p">,</span> <span class="nb">int</span> <span class="n">queueSize</span><span class="p">,</span> <span class="nb">int</span> <span class="n">blockingCallbacks</span><span class="p">,</span>
                   <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">NDArrayPort</span><span class="p">,</span> <span class="nb">int</span> <span class="n">NDArrayAddr</span><span class="p">,</span>
                   <span class="nb">int</span> <span class="n">maxBuffers</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">maxMemory</span><span class="p">,</span>
                   <span class="nb">int</span> <span class="n">priority</span><span class="p">,</span> <span class="nb">int</span> <span class="n">stackSize</span><span class="p">)</span>
</pre></div>
</div>
<p>For details on the meaning of the parameters to this function refer to
the detailed documentation on the NDProcessConfigure function in the
<a class="reference external" href="../areaDetectorDoxygenHTML/_n_d_plugin_process_8cpp.html">NDPluginProcess.cpp
documentation</a>
and in the documentation for the constructor for the <a class="reference external" href="../areaDetectorDoxygenHTML/class_n_d_plugin_process.html">NDPluginProcess
class</a>.</p>
</section>
<section id="screen-shots">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Screen shots</a><a class="headerlink" href="#screen-shots" title="Link to this heading"></a></h2>
<p>The following is the MEDM screen that provides access to the parameters
in <code class="docutils literal notranslate"><span class="pre">NDPluginDriver.h</span></code> and <code class="docutils literal notranslate"><span class="pre">NDPluginProcess.h</span></code> through records in
<code class="docutils literal notranslate"><span class="pre">NDPluginBase.template</span></code> and <code class="docutils literal notranslate"><span class="pre">NDProcess.template</span></code>.
In this example the image is low clipped with a threshold of 300 and a
replacement value of 0, and high-clipped with a threshold of 1000 and a
replacement value of 0.</p>
<img alt="../_images/NDProcess.png" class="align-center" src="../_images/NDProcess.png" />
<p>The following is the MEDM screen for reading a background image or
flatfield image from a TIFF file. It is a stripped-down version of the
normal TIFF plugin screen, and allows specifying the path and filename
components to construct the full filename.</p>
<img alt="../_images/NDProcessTIFF.png" class="align-center" src="../_images/NDProcessTIFF.png" />
<p>In another test the input image is first offset by -4 and scaled by 35.
That result is then clipped to a minimum of 0 and a maximum of 255.
The image is then run through a recursive averaging filter with N=100.</p>
<p>Image collected with 30 microsecond exposure time, so it is very noisy.
This is the image output from the NDPlugProcess plugin with Offset and
Scale as listed above, but with the recursive filter disabled.</p>
<img alt="../_images/NDProcess_unfiltered.jpg" class="align-center" src="../_images/NDProcess_unfiltered.jpg" />
<p>NDPluginStats plugin connected to the NDPluginProcess filter for the
noisy image above. Note that there are only 6 non-zero intensities in
the histogram, because the brightest pixels are only 6 A/D units above
background.</p>
<img alt="../_images/NDStats_unfiltered.png" class="align-center" src="../_images/NDStats_unfiltered.png" />
<p>Same image collected with 30 microsecond exposure time. This is the
image output from the NDPlugProcess plugin with Offset and Scale as
listed above, with the recursive filter enabled. Note the dramatic
improvement in signal to noise.</p>
<img alt="../_images/NDProcess_filtered.jpg" class="align-center" src="../_images/NDProcess_filtered.jpg" />
<p>NDPluginStats plugin connected to the NDPluginProcess filter for the
filtered image above. Note that there are many non-zero intensities in
the histogram, because the filtering is improving the dynamic range
significantly.</p>
<img alt="../_images/NDStats_filtered.png" class="align-center" src="../_images/NDStats_filtered.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="NDPluginOverlay.html" class="btn btn-neutral float-left" title="NDPluginOverlay" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="NDPluginPva.html" class="btn btn-neutral float-right" title="NDPluginPva" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mark Rivers.
      <span class="lastupdated">Last updated on 2024-March-28.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>