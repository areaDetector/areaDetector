

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADPixirad &mdash; areaDetector Support</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme_overrides.css?v=254ed751" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example st.cmd Startup File" href="st_cmd.html" />
    <link rel="prev" title="ADPilatus" href="../ADPilatus/pilatusDoc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            areaDetector
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ADCore/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/arch.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/asynPortDriver.html">asynPortDriver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/NDArray.html">NDArray</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../detector_drivers.html">Detector Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../ADCore/guidelines.html">Guidelines and rules for drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADCore/ADDriver.html">ADDriver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAndor/andorDoc.html">ADAndor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAndor3/ADAndorDoc.html">ADAndor3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADAravis/ADAravis.html">ADAravis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADCSimDetector/ADCSimDetectorDoc.html">ADCSimDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADDexela/ADDexela.html">ADDexela</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADEiger/eiger.html">ADEiger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADEuresys/ADEuresys.html">ADEuresys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADFastCCD/index.html">ADFastCCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADGenICam/ADGenICam.html">ADGenICam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADLambda/ADLambda.html">ADLambda</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADLightField/ADLightField.html">ADLightField</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADmarCCD/marCCDDoc.html">ADmarCCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADmar345/mar345Doc.html">ADmar345</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPerkinElmer/PerkinElmerDoc.html">ADPerkinElmer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPICam/PICamDoc.html">ADPICam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPilatus/pilatusDoc.html">ADPilatus</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ADPixirad</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation-of-standard-driver-parameters">Implementation of standard driver parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pixirad-specific-parameters">Pixirad specific parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unsupported-standard-driver-parameters">Unsupported standard driver parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-st-cmd-startup-file">Example st.cmd startup file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#medm-screens">MEDM screens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-measurements">Performance measurements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restrictions">Restrictions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ADPointGrey/PointGreyDoc.html">ADPointGrey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADProsilica/ADProsilica.html">ADProsilica</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPvCam/pvcamDoc.html">ADPvCam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADPylon/ADPylon.html">ADPylon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADQImaging/QImagingDoc.html">ADQImaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADRIXSCam/ADRIXSCam.html">ADRIXSCam</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADSimDetector/simDetector.html">ADSimDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADSpinnaker/ADSpinnaker.html">ADSpinnaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADTimePix3/ADTimePix3.html">ADTimePix3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADVimba/ADVimba.html">ADVimba</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ADURL/ADURL.html">ADURL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../NDDriverStdArrays/NDDriverStdArraysDoc.html">NDDriverStdArrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pvaDriver/pvaDriver.html">pvaDriver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specsAnalyser/index.html">specsAnalyser</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/plugins.html">areaDetector Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../additional_plugins.html">Additional plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADCore/medm.html">MEDM screens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ADViewers/ad_viewers.html">areaDetector Viewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acknowledgements.html">Acknowledgements and licenses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Top-level Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADCore_release.html">ADCore Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ADSupport_release.html">ADSupport Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">Source Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detectors.html">Supported Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legacy_versions.html">Legacy Versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">areaDetector</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user_guide.html">areaDetector Users Guide</a></li>
          <li class="breadcrumb-item"><a href="../detector_drivers.html">Detector Drivers</a></li>
      <li class="breadcrumb-item active">ADPixirad</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ADPixirad/ADPixirad.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adpixirad">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">ADPixirad</a><a class="headerlink" href="#adpixirad" title="Link to this heading"></a></h1>
<p>areaDetector Pixirad driver</p>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers, University of Chicago</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#adpixirad" id="id1">ADPixirad</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#implementation-of-standard-driver-parameters" id="id3">Implementation of standard driver parameters</a></p></li>
<li><p><a class="reference internal" href="#pixirad-specific-parameters" id="id4">Pixirad specific parameters</a></p></li>
<li><p><a class="reference internal" href="#unsupported-standard-driver-parameters" id="id5">Unsupported standard driver parameters</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id6">Configuration</a></p></li>
<li><p><a class="reference internal" href="#example-st-cmd-startup-file" id="id7">Example st.cmd startup file</a></p></li>
<li><p><a class="reference internal" href="#medm-screens" id="id8">MEDM screens</a></p>
<ul>
<li><p><a class="reference internal" href="#pixirad-adl" id="id9">pixirad.adl</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-measurements" id="id10">Performance measurements</a></p></li>
<li><p><a class="reference internal" href="#restrictions" id="id11">Restrictions</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>This is an <a class="reference internal" href="../index.html"><span class="doc">areaDetector</span></a> driver for the Pixirad detectors from <a class="reference external" href="http://www.pixirad.com/">Pixirad</a>.</p>
<p>The Pixirad detector is a pixel array detector with a cadmium teluride (CdTe)
sensor, so it has high efficiency at high energy. There are 2 versions of the
ASIC, the older PII, and the newer PIII. The PII base module is 476 x 512
pixels, while the PIII is 402 x 512 pixels. The detector is available with a
single module (Pixirad-1), 2 modules (Pixirad-2), and 8 modules (Pixirad-8).</p>
<p>The detector does photon counting of all photons above a programmable energy
threshold. The detector hardware has 2 energy thresholds and two counters per
pixel, so it can collect 2 energy images simultaneously. The PII firmware
supports 4 thresholds, by first collecting 2 energies, and then collecting
another image with 2 additional energies. The detector can be operated in 1, 2,
or 4 color mode. In addition it supports deadtime-free (DTF) counting modes
where one image is being collected while the other is being read out. Both 1 and
2 color DTF modes are supported. The NDArrays produced by this driver are
unsigned 16-bit integers. They have dimensions [XSIZE, YSIZE] for 1 color
images, <code class="docutils literal notranslate"><span class="pre">[XSIZE,</span> <span class="pre">YSIZE,</span> <span class="pre">2]</span></code> for 2 color images, and <code class="docutils literal notranslate"><span class="pre">[XSIZE,</span> <span class="pre">YSIZE,</span> <span class="pre">4]</span></code> for
4 color images. <code class="docutils literal notranslate"><span class="pre">XSIZE=476</span></code> for PII and <code class="docutils literal notranslate"><span class="pre">402</span></code> for PIII.
<code class="docutils literal notranslate"><span class="pre">YSIZE=NumModules*512</span></code> for both the PII and PIII.</p>
<p>The command interface to the detector is via a TCP/IP socket interface to the
detector on port 2222.</p>
<p>The driver receives status information from the detector via UDP broadcast
messages on port 2224. The status includes temperatures, humidity and high
voltage.</p>
<p>The driver receives image data from the detector via UDP broadcast messages on
port 2223 for the Pixirad-1, and port 9999 for the Pixirad-2 and Pixirad-8. This
data is received by a “UDP listener thread” in the driver, which passes the UDP
buffers as they are received via a pointer on an epicsMessageQueue to a “data
unpacking thread”. This second thread unscrambles the UDP buffers, converts them
to areaDetector NDArrays, and does the callbacks to registered plugins. The size
of the epicsMessageQueue is controlled by a parameter passed to the driver
constructor, and is set to 1500 in the example IOC. This provides a buffer in
case the UDP listener thread is receiving images faster than the data unpacking
thread can process them.</p>
<p>The detector can in principle be on a public network where it will receive its
IP address from a DHCP server. In practice the current detector firmware does
not work correctly in this configuration, because the UDP messages do not use
the correct network addresses.  This means that the detector must be placed on a
private network with no DHCP server. It will always have the network address
192.168.0.1.  This also means that the computer running the areaDetector driver
must have 2 network cards, with the one connected to the detector having a host
address on the 192.168.0 subnet.</p>
<p>This driver inherits from <a class="reference internal" href="../ADCore/ADDriver.html"><span class="doc">ADDriver</span></a>. It implements many of the
arameters in <a class="reference external" href="../areaDetectorDoxygenHTML/asyn_n_d_array_driver_8h.html">asynNDArrayDriver.h</a> and in <a class="reference external" href="../areaDetectorDoxygenHTML/_a_d_driver_8h.html">ADArrayDriver.h</a>. It also implements
a number of parameters that are specific to the Pixirad detectors. The
<a class="reference external" href="../areaDetectorDoxygenHTML/classpixirad.html">Pixirad class</a> documentation describes this class in detail.</p>
</section>
<section id="implementation-of-standard-driver-parameters">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Implementation of standard driver parameters</a><a class="headerlink" href="#implementation-of-standard-driver-parameters" title="Link to this heading"></a></h2>
<p>The following table describes how the Pixirad driver implements some
of the standard driver parameters.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>Implementation of Parameters in asynNDArrayDriver.h and ADDriver.h, and EPICS Record
Definitions in ADBase.template and NDFile.template</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p>Parameter index variable</p></th>
<th class="head"><p>EPICS record name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>ADFrameType</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)FrameType</span></code></p></td>
<td><p>The choices for the Pixirad are:</p>
<dl class="simple">
<dt>“1 color low”</dt><dd><p>One color image using threshold 1. On the PII this image is
all photons with energies above threshold 1. On the PIII this is all
photons with energies above threshold 1 and below threshold 2.</p>
</dd>
<dt>“1 color high”</dt><dd><p>One color image using threshold 2. In principle threshold 1 is
ignorred in this mode. However, on the PIII this only works correctly if
threshold 1 is less than threshold 2.</p>
</dd>
<dt>“2 color”</dt><dd><p>Two color image using thesholds 1 and 2.</p>
</dd>
<dt>“4 color”</dt><dd><p>Four color image using thesholds 1, 2, 3, and 4.</p>
</dd>
<dt>“1 color DTF”</dt><dd><p>One color deadtime-free image using theshold 1.</p>
</dd>
<dt>“2 color DTF”</dt><dd><p>Two color deadtime-free image using theshold 1 for color 1, and threshold
3 for color 2. Note that the dimensions of the NDArrays from the Pixirad
driver depend on the value of FrameType. 1 color arrays are 2-D with
dimensions <code class="docutils literal notranslate"><span class="pre">[SIZEX,</span> <span class="pre">SIZEY]</span></code>. 2 color arrays are 3-D with dimensions
<code class="docutils literal notranslate"><span class="pre">[SIZEX,</span> <span class="pre">SIZEY,</span> <span class="pre">2]</span></code>. 4 color arrays are 3-D with dimensions
<code class="docutils literal notranslate"><span class="pre">[SIZEX,</span> <span class="pre">SIZEY,</span> <span class="pre">4]</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>ADTriggerMode</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)TriggerMode</span></code></p></td>
<td><p>The choices for the Pixirad are:</p>
<dl class="simple">
<dt>“Internal”</dt><dd><p>The timing is internal to the detector.</p>
</dd>
<dt>“External”</dt><dd><p>Each external trigger pulse starts the next image. The exposure time is
controlled internally by the AcquireTime record.</p>
</dd>
<dt>“Bulb”</dt><dd><p>The rising edge of the external
trigger signal starts the next image.  The detector continues to
acquire while the external signal is high, and then reads out the
detector on the falling edge of the external trigger signal.</p>
</dd>
</dl>
<p>Note that the minimum time between external trigger pulses is
determined by the FrameType record. This is discussed in the
<a class="reference internal" href="#performance-measurements">Performance measurements</a> section below.</p>
</td>
</tr>
<tr class="row-odd"><td><p>ADTemperature</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)Temperature</span></code></p></td>
<td><p>The setpoint for the cold temperature of the detector.</p></td>
</tr>
<tr class="row-even"><td><p>ADTemperatureActual</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)TemperatureActual</span></code></p></td>
<td><p>The readback of
the temperature on the cold side of the Peltier cooler.</p></td>
</tr>
<tr class="row-odd"><td><p>ADNumImages</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)NumImages</span></code></p></td>
<td><p>Controls the number of images to acquire.</p></td>
</tr>
<tr class="row-even"><td><p>ADAcquirePeriod</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)AcquirePeriod</span></code></p></td>
<td><p>Controls the period between images. If this is greater than the
acquisition time then the detector will wait until the period has
elapsed before collection the next image.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pixirad-specific-parameters">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Pixirad specific parameters</a><a class="headerlink" href="#pixirad-specific-parameters" title="Link to this heading"></a></h2>
<p>The Pixirad driver implements the following parameters in addition to
those in asynNDArrayDriver.h and ADDriver.h. Note that to reduce the
width of this table the parameter index variable names have been split
into 2 lines, but these are just a single name, for example
<cite>AutoCalibrate</cite>.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<colgroup>
<col style="width: 55.0%" />
<col style="width: 15.0%" />
<col style="width: 15.0%" />
<col style="width: 15.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p><strong>Parameter Definitions in pixirad.cpp and EPICS Record Definitions in pixirad.template</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p>Description</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>EPICS record name</p></th>
<th class="head"><p>EPICS record type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td colspan="4"><p><strong>System information</strong></p></td>
</tr>
<tr class="row-even"><td><p>A string containing information about the detector, read directly from the detector.</p></td>
<td><p>SYSTEM_INFO</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)SystemInfo</span></code></p></td>
<td><p>waveform</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><strong>Counting mode (PIII only)</strong></p></td>
</tr>
<tr class="row-even"><td><p>Selects the counting mode. Choices are:</p>
<ul class="simple">
<li><p>0: Normal</p></li>
<li><p>1: NPI This stands for Neighbor Pixel Inhibit. It prevents counting a photon more
than once when charge-sharing occurs., 2: NPISUM This stands for Neighbor Pixel Inhibit with Summation. It sums the charge
from adjacent pixels when charge-sharing occurs.,</p></li>
</ul>
</td>
<td><p>COUNT_MODE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)CountMode</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)CountMode_RBV</span></code></p></td>
<td><p>mbbo, mbbi</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><strong>Cooling parameters</strong></p></td>
</tr>
<tr class="row-even"><td><p>The state of the Peltier cooler. Choices are “Off” (0) and “On” (1).</p></td>
<td><p>COOLING_STATE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)CoolingState</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)Cooling_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>The readback of the temperature (C) on the hot side of the Peltier cooler.</p></td>
<td><p>HOT_TEMPERATURE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HotTemperature_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td><p>The readback of the ambient temperature (C) in the detector box.</p></td>
<td><p>BOX_TEMPERATURE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)BoxTemperature_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-odd"><td><p>The readback of the ambient relative humidity (%) in the detector box.</p></td>
<td><p>BOX_HUMIDITY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)BoxHumidity_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td><p>The calculated dew point (C) based on the BoxHumidity.</p></td>
<td><p>DEW_POINT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)DewPoint_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-odd"><td><p>The power level of the Peltier cooler (%).</p></td>
<td><p>PELTIER_POWER</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)PeltierPower_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td><p>The status of the cooling system. Values are:</p>
<dl class="simple">
<dt>0 - “OK”</dt><dd><p>Cooling status OK.</p>
</dd>
<dt>1 - “Dew Pt Warning”</dt><dd><p>This means that the cold temperature is within 3 degree of
the dew point.</p>
</dd>
<dt>2 - “Dew Pt Error”</dt><dd><p>This means that the cold temperature is less than or equal to
the dew point.</p>
</dd>
<dt>3 - “T Hot Warning”</dt><dd><p>This means that the hot temperature is greater than 40 C.</p>
</dd>
<dt>4 - “T Hot Error”</dt><dd><p>This means that the hot temperature is greater than 50 C.</p>
</dd>
<dt>5 - “T Cold Warning”</dt><dd><p>This means that the cold temperature is greater than 30 C.</p>
</dd>
<dt>6 - “T Cold Error”</dt><dd><p>This means that the cold temperature is greater than 40 C.</p>
</dd>
</dl>
<p>If the CoolingStatus_RBV is any of the Error states then the driver will automatically
turn off the Peltier cooler.</p>
</td>
<td><p>COOLING_STATUS</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)CoolingStatus_RBV</span></code></p></td>
<td><p>mbbi</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><strong>High voltage parameters</strong></p></td>
</tr>
<tr class="row-even"><td><p>High voltage mode. Choices are:</p>
<ul class="simple">
<li><p>0 - “Manual”</p></li>
<li><p>1 - “Auto”</p></li>
</ul>
<p>In Manual mode the high voltage is turned off and on with the HVState record. In
Auto mode if HVState is Off then the high voltage will be automatically turned on
when an acquisition is started and automatically turn off when the acquisition is
complete. This can improve the image quality, because the detector is subject to
charge trapping when used with high x-ray fluxes, and periodically turning off the
high voltage helps to clear the trapped charge.</p>
</td>
<td><p>HV_MODE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVMode</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVMode_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>High voltage state. Choices are:</p>
<ul class="simple">
<li><p>0 - “Off”</p></li>
<li><p>1 - “On”</p></li>
</ul>
<p>This record turns the high voltage off and on. If HVMode is Auto then the high voltage
will be turned on during an acquisition even if HVState is off.</p>
</td>
<td><p>HV_STATE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVState</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVState_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>The high voltage value that will be applied to the detector when HVState=On or when
HVMode=Auto and an acquisition is in progress. The allowed range is 0 to 400 volts.</p></td>
<td><p>HV_VALUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVValue</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVValue_RBV</span></code></p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>The actual high voltage currently being applied to the detector.</p></td>
<td><p>HV_ACTUAL</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVActual_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td><p>The actual high voltage current.</p></td>
<td><p>HV_CURRENT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HVCurrent_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p><strong>Threshold parameters</strong></p></td>
</tr>
<tr class="row-even"><td><p>Requested threshold energy in keV. There are 4 energy thresholds. The threshold
energies are controlled by a single high-resolution register (VThMax) with values
from 1500 to 2200, and 4 low-resoltion registers with values from 0 to 31. The driver
attempts to set Threshold1 as closely as possible to the requested value by changing
both VThMax and the low-resolution register. Thresholds 2-4 are then set as closely
as possible to their requested values using only the low-resolution registers.</p></td>
<td><p>THRESHOLDN (N=1-4)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)ThresholdN</span></code> (N=1-4), <code class="docutils literal notranslate"><span class="pre">$(P)$(R)ThresholdN_RBV</span></code> (N=1-4)</p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>Actual threshold energy in keV. This will be as close as possible to the requested
value, subject to the constraints and algorithm explained above.</p></td>
<td><p>THRESHOLD_ACTUALN (N=1-4)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)ThresholdActualN_RBV</span></code> (N=1-4)</p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td><p>This is only used on the PIII ASIC. It sets the threshold in keV where the PIII
will consider a photon “hit” to have ocurred. This threshold is mainly intended
for use when CountMode=NPI or NPISUM. However, even when CountMode=Normal it must
always be set to a value less than Threshold 1.</p></td>
<td><p>HIT_THRESHOLD</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HitThreshold</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)HitThreshold_RBV</span></code></p></td>
<td><p>ao, ai</p></td>
</tr>
<tr class="row-odd"><td><p>Actual hit threshold energy in keV. This will be as close as possible to the requested
value, subject to the constraints and algorithm explained above.</p></td>
<td><p>HIT_THRESHOLD_ACTUAL</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)HitThresholdActual_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p><strong>External sync parameters</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Polarity of the Sync In signal. Choices are:</p>
<ul class="simple">
<li><p>0 - “Pos.”</p></li>
<li><p>1 - “Neg.”</p></li>
</ul>
</td>
<td><p>SYNC_IN_POLARITY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncInPolarity</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncInPolarity_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>Polarity of the Sync Out signal. Choices are:</p>
<ul class="simple">
<li><p>0 - “Pos.”</p></li>
<li><p>1 - “Neg.”</p></li>
</ul>
</td>
<td><p>SYNC_OUT_POLARITY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncOutPolarity</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncOutPolarity_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-odd"><td><p>Function of the Sync Out signal. Choices are:</p>
<dl class="simple">
<dt>0 - “Shutter”</dt><dd><p>The Sync Out signal is high while the detector is collecting.,</p>
</dd>
<dt>1 - “Read done”</dt><dd><p>The Sync Out signal outputs a pulse when readout is complete.</p>
</dd>
<dt>2 - “Read”</dt><dd><p>The Sync Out signal is high while the detector is reading out.</p>
</dd>
</dl>
</td>
<td><p>SYNC_OUT_FUNCTION</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncOutFunction</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)SyncOutFunction_RBV</span></code></p></td>
<td><p>mbbo, mbbi</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p><strong>Data collection status parameters</strong></p></td>
</tr>
<tr class="row-odd"><td><p>The number of colors collected so far for the current image.</p></td>
<td><p>COLORS_COLLECTED</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)ColorsCollected_RBV</span></code></p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-even"><td><p>The number of UDP buffers (images) read by the UDP listener thread for the current
acquisition.</p></td>
<td><p>UDP_BUFFERS_READ</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)UDPBuffersRead_RBV</span></code></p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-odd"><td><p>The maximum number of UDP buffers (images) for UDP listener thread. This is set
at startup.</p></td>
<td><p>UDP_BUFFERS_MAX</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)UDPBuffersMax_RBV</span></code></p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-even"><td><p>The number of free UDP buffers (images).</p></td>
<td><p>UDP_BUFFERS_FREE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)UDPBuffersFree_RBV</span></code></p></td>
<td><p>longin</p></td>
</tr>
<tr class="row-odd"><td><p>The speed with which the last UDP buffer was received (MB/s).</p></td>
<td><p>UDP_SPEED</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)UDPSpeed_RBV</span></code></p></td>
<td><p>ai</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p><strong>Calibration and reset parameters</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Sends a command to the detector to perform an autocalibration. The detector makes
adjustments to achieve uniform pixel response. This operation <strong>must</strong> be performed
at least once after the detector is power-cycled, and whenever necessary as the
chip temperature and/or supply voltages may drift with time and environmental conditions.
If autocalibration has not been performed then there will be many “hot” (non-zero)
pixels in the image with no x-rays.</p></td>
<td><p>AUTO_CALIBRATE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)AutoCalibrate</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)AutoCalibrate_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
<tr class="row-even"><td><p>Writing 1 to this record sends a command to reset detector to its initial state.
This causes the sockets to disconnect, and it takes about 30 seconds for the system
to recover. Once it recovers the driver then sends commands to set all of the programmable
parameters (thresholds, cooling, high voltage, etc.) to the current values in the
EPICS output records. When the system is available again SystemReset record will
go back to 0.</p></td>
<td><p>SYSTEM_RESET</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">$(P)$(R)SystemReset</span></code>, <code class="docutils literal notranslate"><span class="pre">$(P)$(R)SystemReset_RBV</span></code></p></td>
<td><p>bo, bi</p></td>
</tr>
</tbody>
</table>
</section>
<section id="unsupported-standard-driver-parameters">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Unsupported standard driver parameters</a><a class="headerlink" href="#unsupported-standard-driver-parameters" title="Link to this heading"></a></h2>
<p>The Pixirad driver does not support the following standard driver
parameters:</p>
<ul class="simple">
<li><p>Number of exposures per image (ADNumExposures)</p></li>
<li><p>Gain (ADGain)</p></li>
<li><p>Region to read out or binning (ADMinX, ADMinY, ADSizeX, ADSizeY,
ADBinX, ADBinY, ADReverseX, ADReverseY)</p></li>
<li><p>Data type (NDDataType)</p></li>
</ul>
</section>
<section id="configuration">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Configuration</a><a class="headerlink" href="#configuration" title="Link to this heading"></a></h2>
<p>The Pixirad driver is created with the pixiradConfig command, either
from C/C++ or from the EPICS IOC shell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">pixiradConfig</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">portName</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">commandPortName</span><span class="p">,</span>
                 <span class="nb">int</span> <span class="n">dataPortNumber</span><span class="p">,</span> <span class="nb">int</span> <span class="n">statusPortNumber</span><span class="p">,</span> <span class="nb">int</span> <span class="n">maxDataPortBuffers</span><span class="p">,</span>
                 <span class="nb">int</span> <span class="n">maxSizeX</span><span class="p">,</span> <span class="nb">int</span> <span class="n">maxSizeY</span><span class="p">,</span>
                 <span class="nb">int</span> <span class="n">maxBuffers</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">maxMemory</span><span class="p">,</span>
                 <span class="nb">int</span> <span class="n">priority</span><span class="p">,</span> <span class="nb">int</span> <span class="n">stackSize</span><span class="p">)</span>
</pre></div>
</div>
<p>For details on the meaning of the parameters to this function refer to the
detailed documentation on the pixiradConfig function in the <a class="reference external" href="../areaDetectorDoxygenHTML/pixirad_8cpp.html">pixirad.cpp
documentation</a> and in the documentation for the constructor for the <a class="reference external" href="../areaDetectorDoxygenHTML/classpixirad.html">pixirad
class</a>.</p>
</section>
<section id="example-st-cmd-startup-file">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Example st.cmd startup file</a><a class="headerlink" href="#example-st-cmd-startup-file" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
</div>
<p>There an example IOC boot directory and startup script provided with
areaDetector: <a class="reference internal" href="st_cmd.html"><span class="doc">Example st.cmd Startup File</span></a>.</p>
</section>
<section id="medm-screens">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">MEDM screens</a><a class="headerlink" href="#medm-screens" title="Link to this heading"></a></h2>
<p>The following shows the MEDM screen that are used to control the
Pixirad detector. Note that the general purpose screen ADBase.adl can
be used, but it exposes many controls that are not applicable to the
Pixirad, and lacks some fields that are important for the Pixirad.</p>
<p><cite>pixirad.adl</cite> is the main screen used to control the Pixirad driver.</p>
<section id="pixirad-adl">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">pixirad.adl</a><a class="headerlink" href="#pixirad-adl" title="Link to this heading"></a></h3>
<img alt="../_images/pixirad.png" src="../_images/pixirad.png" />
</section>
</section>
<section id="performance-measurements">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Performance measurements</a><a class="headerlink" href="#performance-measurements" title="Link to this heading"></a></h2>
<p>The following measurements were done to demonstrate the performance
that can be obtained with the areaDetector Pixirad driver. The timings
were done by measuring the frequency of the Sync Out signal on an
oscilloscope. The SyncOutFunction was “Shutter” and 1000 frames were
collected.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>FrameType</p></th>
<th class="head"><p>AcquireTime</p></th>
<th class="head"><p>Frames/sec</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 color low</p></td>
<td><p>0.02</p></td>
<td><p>35.7</p></td>
</tr>
<tr class="row-odd"><td><p>1 color low</p></td>
<td><p>0.01</p></td>
<td><p>57.4</p></td>
</tr>
<tr class="row-even"><td><p>1 color low</p></td>
<td><p>0.01</p></td>
<td><p>57.4</p></td>
</tr>
<tr class="row-odd"><td><p>1 color low</p></td>
<td><p>0.005</p></td>
<td><p>83.3</p></td>
</tr>
<tr class="row-even"><td><p>1 color low</p></td>
<td><p>0.001</p></td>
<td><p>125.0</p></td>
</tr>
<tr class="row-odd"><td><p>1 color DTF</p></td>
<td><p>0.02</p></td>
<td><p>47.3</p></td>
</tr>
<tr class="row-even"><td><p>1 color DTF</p></td>
<td><p>0.01</p></td>
<td><p>93.8</p></td>
</tr>
<tr class="row-odd"><td><p>1 color DTF</p></td>
<td><p>0.005</p></td>
<td><p>143.0</p></td>
</tr>
<tr class="row-even"><td><p>1 color DTF</p></td>
<td><p>0.001</p></td>
<td><p>143.0</p></td>
</tr>
<tr class="row-odd"><td><p>2 color</p></td>
<td><p>0.02</p></td>
<td><p>28.5</p></td>
</tr>
<tr class="row-even"><td><p>2 color</p></td>
<td><p>0.01</p></td>
<td><p>41</p></td>
</tr>
<tr class="row-odd"><td><p>2 color</p></td>
<td><p>0.005</p></td>
<td><p>52</p></td>
</tr>
<tr class="row-even"><td><p>2 color</p></td>
<td><p>0.001</p></td>
<td><p>66</p></td>
</tr>
<tr class="row-odd"><td><p>2 color DTF</p></td>
<td><p>0.02</p></td>
<td><p>23.4</p></td>
</tr>
</tbody>
</table>
<p>The measurements above were made with TriggerMode=Internal. Additional
measurements made using TriggerMode=External showed that the maximum
frame rate was the same as that shown in the table, i.e. as soon as
the external trigger frequency exceeded this value the detector
ignored every second external trigger pulse.</p>
<p>The data above show that the detector overhead is about 7.5 ms in “1
color low” mode. In “1 color DTF” mode the overhead is about 0.7 ms,
but with a minimum frame period of 7 ms. In “2 color” mode the
overhead is 15 ms, or 7.5 ms per image, the same as in “1 color low”.
In “4 color” mode two exposures are required. The total time is equal
to <code class="docutils literal notranslate"><span class="pre">AcquireTime*2</span> <span class="pre">+</span> <span class="pre">0.0075*4</span></code>, so again the overhead is about 7.5
ms per image.</p>
</section>
<section id="restrictions">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Restrictions</a><a class="headerlink" href="#restrictions" title="Link to this heading"></a></h2>
<p>The following are some current restrictions of the Pixirad driver due
to bugs in the Pixirad firmware:</p>
<ul class="simple">
<li><p>The detector does not accept a high-voltage value unless 2 different
values are sent to it after power-cycle or system reset. The
areaDetector driver works around this problem by sending the requested
voltage minus 1.0 and then the requested voltage when the IOC starts
up, and also after a system reset. However, it appears that even this
is sometimes not sufficient. To see if this is a problem set the
HVState to On and see if the HVActual is close to the requested value.
If it is not, for example if it is only 12V or so, then change the
HVValue to something else and then back to the requested value. This
should fix the problem.</p></li>
<li><p>At high frame rates there can be occasional loss of UDP packets.
This will result in an error message on the IOC console,
UDPBuffersRead will be fewer than NumImages, and the Acquire PV will
not go back to 0. If this happens then press the Stop button (setting
Acquire to 0). If a DTF sequence was being acquired then sometimes all
subsequent images will be corrupted, and it will be necessary to
restart the EPICS IOC.</p></li>
<li><p>If a long acquisition sequence is started it is not currently
possible to make the detector abort it. There is a command that can be
sent to the detector to abort an acquisition, but unfortunately this
causes the detector to malfunction for subsequent acquisitions.</p></li>
<li><p>The detector does not send UDP status packets during acquisition. If
the HVMode=Auto and HVState=Off, which is a normal way to operate,
then the HVActual readback will be 0 during acquisition, because no
status update happens after the high voltage is automatically turned
on at the start of acquisition. Immediately upon completion of
acquisition the status updates begin, and a few non-zero values will
be observed as the high voltage ramps down. This is normal, but it may
cause confusion, since it appears that the high voltage has not been
turned on during acquisition, when actually it was.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ADPilatus/pilatusDoc.html" class="btn btn-neutral float-left" title="ADPilatus" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="st_cmd.html" class="btn btn-neutral float-right" title="Example st.cmd Startup File" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mark Rivers.
      <span class="lastupdated">Last updated on 2024-October-30.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>